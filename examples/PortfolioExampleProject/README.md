# PortfolioExampleProject

This project serves as a comprehensive example of the **`paper-portfolio`** component within the **P.A.P.E.R** (Platform for Asset Pricing Experimentation and Research) framework.

The primary goal of this example is to demonstrate how to construct, backtest, and evaluate long-short portfolio strategies based on the predictive outputs generated by the `paper-model` component. It showcases the tool's ability to consume model predictions, apply various sorting and weighting schemes, and generate a rich set of performance analytics and visualizations.

- **Initialized on:** 2025-06-01
- **P.A.P.E.R Tools Version:** 0.1.0

---

## ðŸ“– Workflow Overview

This example focuses exclusively on the portfolio construction and evaluation phase of the P.A.P.E.R workflow. It assumes that the model training and prediction generation have already been completed.

1.  **Data Setup:** The project is configured to use pre-computed prediction files from three different machine learning models, along with supplementary data for risk-free rates and market benchmarks.
2.  **Configure the Portfolios:** The `portfolio-config.yaml` file defines the strategies to be tested, including which quantiles to long and short, the weighting scheme, and the performance metrics to calculate.
3.  **Execute the Pipeline:** A single `paper execute portfolio` command triggers the entire backtesting and evaluation process for every combination of model and strategy.

---

## ðŸš€ Getting Started

This guide assumes you have cloned the `paper-asset-pricing` monorepo and have set up the Python environment as described in the main `README.md`.

**Crucially, this project relies on the output of a model execution phase.** It expects to find prediction files in the `portfolios/predictions/` directory.

### 1. Data Setup

This example uses pre-computed prediction files and supplementary datasets to focus on the portfolio construction capabilities. The necessary data is already included in the project's `portfolios/` directory. No data generation or modeling steps are required.

-   **Model Predictions:** The `portfolios/predictions/` directory should contain the out-of-sample prediction files from the models you wish to test. For this example, we use:
    -   `pls_full_tuned_predictions.parquet`
    -   `pcr_full_tuned_predictions.parquet`
    -   `rf_full_tuned_predictions.parquet`
-   **Additional Datasets:** The `portfolios/additional_datasets/` directory must contain any other files required by the configuration, such as:
    -   `risk_free.csv`: For calculating risk-adjusted returns.
    -   `benchmark_stock_dec1989_dec2021.csv`: For plotting a benchmark (e.g., S&P 500) against strategy performance.

### 2. Review the Portfolio Configuration

The heart of this example is the `configs/portfolios-config.yaml` file. It provides a detailed specification for backtesting long-short strategies based on the model predictions.

**Key aspects of the configuration include:**

-   **Input Models:** The configuration explicitly lists the three models (`pls_full_tuned`, `pcr_full_tuned`, `rf_full_tuned`) whose predictions will be used to form portfolios.
-   **Portfolio Strategies:**
    -   `EQ90`: A standard decile-sort strategy that goes long the top 10% of predicted performers and short the bottom 10%, with equal weighting.
    -   `EQ95`: A more conservative strategy that longs the 90th-95th percentile and shorts the 5th-10th percentile, designed to avoid the most extreme (and potentially volatile) assets.
    -   The file also includes commented-out examples (`VAL90`, `VAL95`) to show how value-weighted strategies would be configured.
-   **Evaluation & Analytics:**
    -   **Metrics:** Calculates key performance indicators like `sharpe_ratio`, `expected_shortfall`, and `cumulative_return`.
    -   **Cross-Sectional Analysis:** Generates plots showing the performance of each prediction decile, providing a powerful diagnostic to confirm that higher predictions correlate with higher returns.

You can review the full, annotated configuration file in the `configs/` directory to see the detailed setup.

### 3. Execute the Portfolio Pipeline

From the root of the `PortfolioExampleProject` directory, run the portfolio execution command. This will apply each defined strategy to each model's predictions and generate all specified reports and plots.

```bash
paper execute portfolio
```

---

## âœ… Expected Output

After the command finishes, the `portfolio/` directory will be populated with a rich set of analysis artifacts.

**Console Output:**

The console will show a simple success message. All detailed output is captured in `logs.log`.

```
>>> Executing Portfolios Phase <<<
Auto-detected project root: /path/to/PortfolioExampleProject
Portfolios phase completed successfully. Additional information in '/path/to/PortfolioExampleProject/logs.log'
```

**Log File (`logs.log`):**

The `logs.log` file provides a step-by-step account of the backtest. You can see which prediction and supplementary files are being loaded, which strategy is being applied, and confirmation that reports and plots are being saved.

**Output Artifacts:**

The `portfolios/` directory will contain the following subdirectories filled with results:

-   `portfolios/results/`: Contains performance summaries for each model-strategy combination.
    -   **Text Reports** (e.g., `rf_full_tuned_EQ90_report.txt`): A human-readable summary of the key performance metrics.
    -   **Metrics Data** (e.g., `rf_full_tuned_EQ90_metrics.csv`): A machine-readable file with the calculated metrics.
    -   **Cumulative Return Plots** (e.g., `pls_full_tuned_EQ95_cumulative_returns.png`): A plot showing the growth of investing in the long, short, and long-short legs of the strategy over time, compared against the market benchmark.
-   `portfolios/results/cross_sectional_analysis`: Contains visualizations of the portfolio performance
    -   **Cross-Sectional Analysis Plots** (e.g., `pcr_full_tuned_cross_sectional_performance.png`): A bar chart showing the average monthly return for each of the 10 prediction-sorted deciles, demonstrating the monotonic relationship between predictions and outcomes.
